<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Post-it Pixel Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===================== CSS ===================== -->
<style>
/* ====== ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ====== */
body {
  font-family: 'Press Start 2P', cursive;
  background: repeating-linear-gradient(45deg,#fce4ec,#fce4ec 20px,#f8bbd0 20px,#f8bbd0 40px);
  margin:0; padding:20px;
  display:flex; flex-direction:column; align-items:center;
}

h1 { font-size:16px; color:#ff4081; text-align:center; margin-bottom:15px; }

/* ====== ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ====== */
.controls{
  display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:15px;
}
.button{
  width:50px; height:50px; font-size:12px;
  border:3px solid #333; background:#ffd54f;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; box-shadow:4px 4px 0 #333;
}
.button:hover{ transform:scale(1.1); }

/* ====== ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ====== */
#canvas{
  width:90%; max-width:1200px; height:600px;
  border:4px solid #333; background:#fff9c4;
  position:relative; overflow:hidden;
}
#canvas.pc{ width:1280px; height:720px; }
#canvas.mobile{ width:360px; height:640px; }

/* ====== Post-it ====== */
.postit{
  position:absolute; width:120px; min-width:60px; min-height:60px; background:#ffeb3b;
  border:3px solid #333; display:flex; flex-direction:column; justify-content:center;
  align-items:center; padding:4px; box-shadow:4px 4px 0 #333;
}
.postit textarea{
  width:100%; border:none; background:transparent; outline:none;
  text-align:center; font-size:8px; font-family:'Press Start 2P', cursive;
  overflow:hidden; flex:1;
}

/* ====== ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö ====== */
.delete-btn{
  position:absolute; top:-10px; right:-10px; width:20px; height:20px;
  background:red; color:white; border:2px solid #333; text-align:center; cursor:pointer;
}

/* ====== Toolbar ====== */
#toolbar-postit{
  display:none; position:absolute; background:#ffcc80;
  border:3px solid #333; padding:5px; box-shadow:4px 4px 0 #333;
  z-index:2000; display:flex; gap:5px; flex-wrap:wrap;
}
#toolbar-postit .color-swatch{
  width:28px; height:28px; border:2px solid #333; cursor:pointer;
}
#toolbar-postit button{
  width:28px; height:28px; font-size:10px; background:#444; color:white; cursor:pointer;
}
#toolbar-postit button:hover{ background:#666; }

/* ====== Resizer ====== */
.resizer{
  width:16px; height:16px; position:absolute; right:0; bottom:0;
  background:rgba(0,0,0,0.5); cursor:se-resize;
}
</style>
</head>

<body>

<!-- ===================== HTML ===================== -->
<h1>Post-it Pixel Wallpaper Editor</h1>

<div class="controls">
  <button class="button" onclick="setLayout('pc')">üñ•Ô∏è</button>
  <button class="button" onclick="setLayout('mobile')">üì±</button>
  <button class="button" onclick="addPostIt()">‚ûï</button>
  <label class="button">üñºÔ∏è
    <input type="file" id="imageUpload" accept="image/*" style="display:none;">
  </label>
  <button class="button" onclick="downloadImage()">‚¨áÔ∏è</button>
  <button class="button" onclick="undoAction()">‚Ü©Ô∏è</button>
  <button class="button" onclick="redoAction()">‚Ü™Ô∏è</button>
  <input type="color" id="canvasColor" style="width:40px;height:40px;">
</div>

<div id="canvas" class="pc"></div>

<div id="toolbar-postit">
  <div class="color-swatch" style="background:#ffeb3b;" onclick="changeColor('#ffeb3b')"></div>
  <div class="color-swatch" style="background:#4fc3f7;" onclick="changeColor('#4fc3f7')"></div>
  <div class="color-swatch" style="background:#aed581;" onclick="changeColor('#aed581')"></div>
  <div class="color-swatch" style="background:#f48fb1;" onclick="changeColor('#f48fb1')"></div>
  <button onclick="changeShape('0')">‚ñ†</button>
  <button onclick="changeShape('50%')">‚óè</button>
  <button onclick="changeShape('10px')">‚¨í</button>
</div>

<!-- ===================== JavaScript ===================== -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const canvas = document.getElementById('canvas');
const toolbar = document.getElementById('toolbar-postit');
let selectedPostIt = null;
let undoStack = [], redoStack = [];

// ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ======
function saveState(){ undoStack.push(canvas.innerHTML); if(undoStack.length>50) undoStack.shift(); }
function undoAction(){ if(undoStack.length){ redoStack.push(canvas.innerHTML); canvas.innerHTML = undoStack.pop(); rebindAll(); } }
function redoAction(){ if(redoStack.length){ undoStack.push(canvas.innerHTML); canvas.innerHTML = redoStack.pop(); rebindAll(); } }

// ====== ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Post-it ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏î‡πâ ======
function makeDraggable(el){
  let drag=false, offsetX, offsetY;
  function start(x,y){ drag=true; const r=el.getBoundingClientRect(); offsetX=x-r.left; offsetY=y-r.top; el.style.zIndex=1000; }
  function move(x,y){ if(!drag) return; const r=canvas.getBoundingClientRect(); el.style.left=Math.max(0,Math.min(x-r.left-offsetX,canvas.clientWidth-el.offsetWidth))+'px'; el.style.top=Math.max(0,Math.min(y-r.top-offsetY,canvas.clientHeight-el.offsetHeight))+'px'; if(selectedPostIt===el) showToolbar(el); }
  function end(){ drag=false; el.style.zIndex=1; saveState(); }
  el.addEventListener('mousedown', e=>{ if(e.target.classList.contains('delete-btn')||e.target.classList.contains('resizer')) return; start(e.clientX,e.clientY); });
  document.addEventListener('mousemove', e=>move(e.clientX,e.clientY));
  document.addEventListener('mouseup', end);
  el.addEventListener('touchstart', e=>{ const t=e.touches[0]; start(t.clientX,t.clientY); e.preventDefault(); }, {passive:false});
  document.addEventListener('touchmove', e=>{ if(!e.touches) return; const t=e.touches[0]; move(t.clientX,t.clientY); }, {passive:false});
  document.addEventListener('touchend', end);
}

function makeResizable(el){
  const res = document.createElement('div'); res.className='resizer'; el.appendChild(res);
  let startX,startY,startW,startH;
  function init(x,y){ startX=x; startY=y; startW=el.offsetWidth; startH=el.offsetHeight; }
  function resize(x,y){ el.style.width=Math.max(60,startW+x-startX)+'px'; el.style.height=Math.max(60,startH+y-startY)+'px'; if(selectedPostIt===el) showToolbar(el); }
  function stop(){ document.removeEventListener('mousemove', mouseMove); document.removeEventListener('mouseup', stop); document.removeEventListener('touchmove', touchMove); document.removeEventListener('touchend', stop); }
  function mouseMove(e){ resize(e.clientX,e.clientY); }
  function touchMove(e){ resize(e.touches[0].clientX,e.touches[0].clientY); }
  res.addEventListener('mousedown', e=>{ e.stopPropagation(); init(e.clientX,e.clientY); document.addEventListener('mousemove', mouseMove); document.addEventListener('mouseup', stop); });
  res.addEventListener('touchstart', e=>{ e.stopPropagation(); init(e.touches[0].clientX,e.touches[0].clientY); document.addEventListener('touchmove', touchMove,{passive:false}); document.addEventListener('touchend', stop); },{passive:false});
}

// ====== ‡πÄ‡∏û‡∏¥‡πà‡∏° Post-it ======
function addPostIt(){
  saveState();
  const post = document.createElement('div'); post.className='postit';
  post.style.top='20px'; post.style.left='20px';
  const ta = document.createElement('textarea'); ta.placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô..."; post.appendChild(ta);
  const del = document.createElement('div'); del.className='delete-btn'; del.innerText='X';
  del.onclick=()=>{ post.remove(); toolbar.style.display='none'; selectedPostIt=null; saveState(); }
  post.appendChild(del);
  makeDraggable(post); makeResizable(post);
  post.addEventListener('click', e=>{ e.stopPropagation(); showToolbar(post); });
  canvas.appendChild(post);
}

// ====== Toolbar ======
function showToolbar(el){
  selectedPostIt=el;
  const r=el.getBoundingClientRect(), c=canvas.getBoundingClientRect();
  let left=r.right-c.left+5, top=r.top-c.top;
  if(left+toolbar.offsetWidth>canvas.clientWidth) left=r.left-c.left-toolbar.offsetWidth-5;
  if(top+toolbar.offsetHeight>canvas.clientHeight) top=r.top-c.top-toolbar.offsetHeight-5;
  toolbar.style.left=left+'px'; toolbar.style.top=top+'px'; toolbar.style.display='flex';
}
function changeColor(c){ if(selectedPostIt) selectedPostIt.style.background=c; saveState(); }
function changeShape(r){ if(selectedPostIt) selectedPostIt.style.borderRadius=r; saveState(); }

// ====== Layout ======
function setLayout(t){ canvas.classList.remove('pc','mobile'); canvas.classList.add(t); }

// ====== ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ ======
document.getElementById('imageUpload').addEventListener('change', function(e){
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(ev){
    saveState();
    const imgDiv=document.createElement('div'); imgDiv.className='image-item'; imgDiv.style.top='30px'; imgDiv.style.left='30px';
    const img=document.createElement('img'); img.src=ev.target.result; img.style.width='120px'; img.style.height='120px'; img.style.border='3px solid #333';
    imgDiv.appendChild(img); makeDraggable(imgDiv);
    const del=document.createElement('div'); del.className='delete-btn'; del.innerText='X'; del.onclick=()=>{ imgDiv.remove(); saveState(); };
    imgDiv.appendChild(del);
    canvas.appendChild(imgDiv);
  }
  reader.readAsDataURL(file);
});

// ====== ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ======
function downloadImage(){ toolbar.style.display='none'; html2canvas(canvas).then(c=>{ const link=document.createElement('a'); link.download='postit.png'; link.href=c.toDataURL(); link.click(); }); }

// ====== ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ======
document.getElementById('canvasColor').addEventListener('input',function(){ canvas.style.background=this.value; });
document.addEventListener('click',()=>{ toolbar.style.display='none'; selectedPostIt=null; });
</script>

</body>
</html>
